---
import type { ComponentType } from 'react';
import Metatags from '../components/Metatags.astro';
import { SITE_GOAT_COUNTER, SITE_TITLE } from '../constants';
import '../index.css';

export interface Props<P> {
	url?: string;
	title?: string;
	pageTitle?: string;
	description?: string;
	hygraphImageHandle?: string;
	component?: ComponentType<P>;
	props?: Omit<P, 'title' | 'url'>;
}

const { component: Page } = Astro.props;

function getTitle<P>({
	title,
	pageTitle,
}: Pick<Props<P>, 'title' | 'pageTitle'>) {
	if (pageTitle) {
		return pageTitle;
	}

	if (title) {
		return `${title} by ${SITE_TITLE}`;
	}

	return SITE_TITLE;
}
---

<!doctype html>
<html lang="en">
	<head>
		<title>{getTitle(Astro.props)}</title>
		<Metatags {...Astro.props} />
	</head>
	<body>
		{
			Page ? (
				<Page {...Astro.props.props} {...Astro.props}>
					<slot />
				</Page>
			) : (
				<slot />
			)
		}
		{
			import.meta.env.PROD && (
				<script
					is:inline
					data-goatcounter={`https://${SITE_GOAT_COUNTER}.goatcounter.com/count`}
					async
					src="//gc.zgo.at/count.js"
				/>
			)
		}
	</body>
</html>
